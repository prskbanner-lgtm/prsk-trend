<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç”»å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° & ãƒˆãƒ¬ãƒ³ãƒ‰</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
            --bg-color: #f4f7f6; /* å°‘ã—ã‚°ãƒ¬ãƒ¼ã‚’å…¥ã‚Œã¦ç›®ã«å„ªã—ã */
            --card-bg: #ffffff;
            --text-main: #2c3e50;
            --text-sub: #95a5a6;
            --accent-color: #ff4b4b; /* é®®ã‚„ã‹ãªèµ¤ */
            --accent-hover: #ff3333;
            --border-radius: 16px;
            --shadow: 0 10px 30px rgba(0,0,0,0.05); /* ãµã‚“ã‚ã‚Šã—ãŸå½± */
            --shadow-hover: 0 15px 35px rgba(0,0,0,0.1);
            
            /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”¨ã‚«ãƒ©ãƒ¼ */
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px; /* ã‚¹ãƒãƒ›ã§ã®ä½™ç™½ */
        }

        /* --- 1. ãƒˆãƒ¬ãƒ³ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ --- */
        .trend-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .trend-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 16px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .trend-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .trend-card img {
            width: 100px;
            height: 56px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
        }

        .trend-info {
            flex: 1;
            min-width: 0;
        }

        .trend-info h3 {
            margin: 0 0 4px 0;
            font-size: 0.85rem;
            color: var(--accent-color);
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }
        
        .trend-info p {
            margin: 0;
            font-weight: 700;
            font-size: 0.95rem;
            line-height: 1.4;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        @media (min-width: 900px) {
            .main-content {
                flex-direction: row;
                align-items: flex-start;
                height: calc(100vh - 220px);
                min-height: 600px;
            }

            .graph-area {
                flex: 2;
                height: 100%;
            }

            .ranking-area {
                flex: 1;
                height: 100%;
                overflow: hidden; /* å†…éƒ¨ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®ãŸã‚ */
                display: flex;
                flex-direction: column;
            }
        }

        /* --- 2. ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ --- */
        .graph-area {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .graph-header {
            margin-bottom: 20px;
        }

        .tags {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .graph-header h2 {
            margin: 0;
            font-size: 1.4rem;
            line-height: 1.3;
        }

        .chart-container {
            flex-grow: 1;
            position: relative;
            min-height: 300px;
            width: 100%;
        }

        /* ã‚°ãƒ©ãƒ•ä¸‹ã®ã‚¹ã‚¿ãƒƒãƒ„ã‚’ã‚«ãƒ¼ãƒ‰åŒ– */
        .graph-footer {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .stat-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
        }

        .stat-card .label {
            font-size: 0.75rem;
            color: var(--text-sub);
            display: block;
            margin-bottom: 4px;
        }

        .stat-card .value {
            font-family: 'Roboto', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .stat-card .value.growth {
            color: var(--accent-color);
        }

        /* --- 3. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¨ãƒªã‚¢ --- */
        .ranking-area {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 24px;
        }

        .ranking-area h3 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
        }

        .ranking-list-container {
            overflow-y: auto; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é ˜åŸŸ */
            flex: 1;
            padding-right: 5px; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã¨ã®å¹²æ¸‰é¿ã‘ */
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .ranking-list-container::-webkit-scrollbar {
            width: 6px;
        }
        .ranking-list-container::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 3px;
        }

        .ranking-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
            border: 1px solid transparent;
        }

        .ranking-item:hover {
            background-color: #f8f9fa;
            transform: translateX(4px);
        }

        .ranking-item.active {
            background-color: #fff5f5;
            border-color: #ffe0e0;
        }
        
        .ranking-item.active .item-title {
            color: var(--accent-color);
            font-weight: 700;
        }

        .rank-badge {
            font-family: 'Roboto', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            width: 30px;
            text-align: center;
            margin-right: 12px;
            color: var(--text-sub);
        }

        /* 1ä½ã€œ3ä½ã®ç‰¹åˆ¥è£…é£¾ */
        .ranking-item:nth-child(1) .rank-badge { color: var(--gold); font-size: 1.4rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .ranking-item:nth-child(2) .rank-badge { color: var(--silver); font-size: 1.3rem; }
        .ranking-item:nth-child(3) .rank-badge { color: var(--bronze); font-size: 1.2rem; }

        .item-thumb {
            width: 60px;
            height: 34px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .item-info {
            flex: 1;
            min-width: 0;
        }

        .item-title {
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.4;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-stats {
            font-family: 'Roboto', sans-serif;
            font-size: 0.75rem;
            color: var(--text-sub);
            margin-top: 2px;
            display: block;
        }

    </style>
</head>
<body>

<div class="container">

    <div class="trend-section" id="trendSection">
        <div class="trend-card">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div class="main-content">
        
        <div class="graph-area">
            <div class="graph-header">
                <div class="tags">
                    <span class="tag" id="currentUnit">-</span>
                    <span class="tag" id="currentChar">-</span>
                </div>
                <h2 id="currentTitle">å‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            </div>

            <div class="chart-container">
                <canvas id="viewChart"></canvas>
            </div>

            <div class="graph-footer">
                <div class="stat-card">
                    <span class="label">ç¾åœ¨å†ç”Ÿæ•°</span>
                    <span class="value" id="currentViews">-</span>
                </div>
                <div class="stat-card">
                    <span class="label">å‰å›æ¯” (å¢—åŠ é‡)</span>
                    <span class="value growth" id="currentGrowth">-</span>
                </div>
                <div class="stat-card">
                    <span class="label">æŠ•ç¨¿æ—¥</span>
                    <span class="value" id="currentDate">-</span>
                </div>
            </div>
        </div>

        <div class="ranking-area">
            <h3>Ranking</h3>
            <div class="ranking-list-container">
                <ul class="ranking-list" id="rankingList">
                    </ul>
            </div>
        </div>

    </div>
</div>

<script>
    let chartInstance = null;
    let allData = {}; 

    // JSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    fetch('stats_history.json')
        .then(response => response.json())
        .then(data => {
            allData = data;
            initApp(data);
        })
        .catch(err => console.error('Data load error:', err));

    function initApp(data) {
        const videoArray = Object.keys(data).map(key => {
            const history = data[key].history;
            const latest = history[history.length - 1];
            const prev = history.length > 1 ? history[history.length - 2] : latest;
            
            return {
                id: key,
                info: data[key].info,
                latestViews: latest.views,
                growth: latest.views - prev.views,
                history: history,
                uploadDateObj: new Date(data[key].info.uploadDate)
            };
        });

        renderTrends(videoArray);

        videoArray.sort((a, b) => b.latestViews - a.latestViews);
        renderRanking(videoArray);

        if (videoArray.length > 0) {
            updateGraph(videoArray[0]);
        }
    }

    function renderTrends(videos) {
        const section = document.getElementById('trendSection');
        
        const newest = [...videos].sort((a, b) => b.uploadDateObj - a.uploadDateObj)[0];
        const trending = [...videos].sort((a, b) => b.growth - a.growth)[0];
        const mostViewed = [...videos].sort((a, b) => b.latestViews - a.latestViews)[0];

        const createCard = (label, video, icon) => `
            <div class="trend-card" onclick="selectVideo('${video.id}')">
                <img src="${video.info.thumbnail}" alt="thumb">
                <div class="trend-info">
                    <h3>${icon} ${label}</h3>
                    <p>${video.info.title}</p>
                </div>
            </div>
        `;

        section.innerHTML = `
            ${createCard('Newest', newest, 'ğŸ†•')}
            ${createCard('Trending', trending, 'ğŸ“ˆ')}
            ${createCard('Top View', mostViewed, 'ğŸ‘‘')}
        `;
    }

    function renderRanking(videos) {
        const list = document.getElementById('rankingList');
        list.innerHTML = '';

        videos.forEach((video, index) => {
            const li = document.createElement('li');
            li.className = 'ranking-item';
            li.id = `rank-${video.id}`;
            li.onclick = () => {
                updateGraph(video);
                document.querySelectorAll('.ranking-item').forEach(el => el.classList.remove('active'));
                li.classList.add('active');
            };

            li.innerHTML = `
                <div class="rank-badge">${index + 1}</div>
                <img class="item-thumb" src="${video.info.thumbnail}">
                <div class="item-info">
                    <p class="item-title">${video.info.title}</p>
                    <span class="item-stats">${video.latestViews.toLocaleString()} å›</span>
                </div>
            `;
            list.appendChild(li);
        });
        
        if(videos.length > 0) {
             document.getElementById(`rank-${videos[0].id}`).classList.add('active');
        }
    }

    window.selectVideo = function(id) {
        const vidKey = Object.keys(allData).find(k => k === id);
        if (!vidKey) return;

        const history = allData[vidKey].history;
        const latest = history[history.length - 1];
        const prev = history.length > 1 ? history[history.length - 2] : latest;

        const videoObj = {
            id: vidKey,
            info: allData[vidKey].info,
            latestViews: latest.views,
            growth: latest.views - prev.views,
            history: history,
            uploadDateObj: new Date(allData[vidKey].info.uploadDate)
        };

        updateGraph(videoObj);
        
        document.querySelectorAll('.ranking-item').forEach(el => el.classList.remove('active'));
        const rankItem = document.getElementById(`rank-${id}`);
        if(rankItem) {
            rankItem.classList.add('active');
            rankItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    function updateGraph(video) {
        document.getElementById('currentUnit').textContent = video.info.unit || '-';
        document.getElementById('currentChar').textContent = video.info.character || '-';
        document.getElementById('currentTitle').textContent = video.info.title;

        document.getElementById('currentViews').textContent = video.latestViews.toLocaleString();
        const growthEl = document.getElementById('currentGrowth');
        growthEl.textContent = (video.growth >= 0 ? '+' : '') + video.growth.toLocaleString();
        
        const dateStr = video.uploadDateObj.toLocaleDateString('ja-JP');
        document.getElementById('currentDate').textContent = dateStr;

        const ctx = document.getElementById('viewChart').getContext('2d');
        
        if (chartInstance) {
            chartInstance.destroy();
        }

        const labels = video.history.map(h => {
            const d = new Date(h.timestamp);
            return `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:00`;
        });
        const dataPoints = video.history.map(h => h.views);

        // ã‚°ãƒ©ãƒ•ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
        let gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(255, 75, 75, 0.5)');
        gradient.addColorStop(1, 'rgba(255, 75, 75, 0.0)');

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'å†ç”Ÿå›æ•°',
                    data: dataPoints,
                    borderColor: '#ff4b4b',
                    backgroundColor: gradient,
                    borderWidth: 3,
                    pointRadius: 0, // é€šå¸¸æ™‚ã¯ãƒã‚¤ãƒ³ãƒˆã‚’éš ã™
                    pointHoverRadius: 6,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#ff4b4b',
                    pointBorderWidth: 2,
                    tension: 0.4, // æ›²ç·šã‚’æ»‘ã‚‰ã‹ã«
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(0,0,0,0.8)',
                        titleFont: { family: 'Noto Sans JP' },
                        bodyFont: { family: 'Roboto' },
                        padding: 10,
                        cornerRadius: 8,
                        displayColors: false
                    }
                },
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: { font: { size: 10 }, maxTicksLimit: 6 }
                    },
                    y: {
                        grid: { borderDash: [4, 4], color: '#eeeeee' },
                        ticks: { font: { family: 'Roboto' } },
                        beginAtZero: false
                    }
                }
            }
        });
    }
</script>

</body>
</html>
