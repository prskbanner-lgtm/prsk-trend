<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç”»å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° & ãƒˆãƒ¬ãƒ³ãƒ‰</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #333;
            --accent-color: #FF0000; /* YouTube Red */
            --gray-light: #f0f0f0;
            --border-color: #e0e0e0;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- 1. ãƒˆãƒ¬ãƒ³ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ (æœ€ä¸Šéƒ¨) --- */
        .trend-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .trend-card {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .trend-card img {
            width: 100px;
            height: 56px; /* 16:9 */
            object-fit: cover;
            border-radius: 4px;
        }

        .trend-info h3 {
            margin: 0 0 5px 0;
            font-size: 0.9rem;
            color: #666;
        }
        
        .trend-info p {
            margin: 0;
            font-weight: bold;
            font-size: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* --- ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (ã‚°ãƒ©ãƒ•ã¨ãƒ©ãƒ³ã‚­ãƒ³ã‚°) --- */
        .main-content {
            display: flex;
            flex-direction: column; /* ã‚¹ãƒãƒ›(ç¸¦ç”»é¢)ã¯ç¸¦ç©ã¿ */
            gap: 20px;
        }

        /* PCãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ(æ¨ªç”»é¢)ç”¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media (min-width: 768px) {
            .main-content {
                flex-direction: row;
                height: calc(100vh - 250px); /* ç”»é¢å†…ã«åã‚ã‚‹å·¥å¤« */
                min-height: 500px;
            }

            .graph-area {
                flex: 2; /* ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ã‚’åºƒã */
            }

            .ranking-area {
                flex: 1;
                overflow-y: auto; /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã ã‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
            }
        }

        /* --- 2. ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ (å·¦å´/ä¸Šå´) --- */
        .graph-area {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .graph-header {
            margin-bottom: 10px;
        }

        .graph-header .unit-info {
            display: inline-block;
            background: var(--gray-light);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .graph-header h2 {
            margin: 10px 0 5px 0;
            font-size: 1.2rem;
        }

        .chart-container {
            flex-grow: 1;
            position: relative;
            min-height: 300px;
        }

        .graph-footer {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            text-align: center;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .stat-item .label {
            font-size: 0.8rem;
            color: #666;
            display: block;
        }

        .stat-item .value {
            font-size: 1.1rem;
            font-weight: bold;
        }

        /* --- 3. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¨ãƒªã‚¢ (å³å´/ä¸‹å´) --- */
        .ranking-area {
            background: #fff;
            /* PCã§ã¯ãƒœãƒ¼ãƒ€ãƒ¼ã‚ã‚Šã€ã‚¹ãƒãƒ›ã§ã¯èƒŒæ™¯ã®ã¿ãªã©èª¿æ•´å¯ */
        }

        .ranking-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
        }

        .ranking-item:hover, .ranking-item.active {
            background-color: #f9f9f9;
        }

        .rank-badge {
            font-size: 1.2rem;
            font-weight: bold;
            width: 30px;
            text-align: center;
            margin-right: 10px;
            color: var(--accent-color);
        }

        .item-thumb {
            width: 80px;
            height: 45px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-size: 0.9rem;
            margin: 0;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item-stats {
            font-size: 0.8rem;
            color: #666;
        }

    </style>
</head>
<body>

<div class="container">

    <div class="trend-section" id="trendSection">
        <div class="trend-card">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <div class="main-content">
        
        <div class="graph-area">
            <div class="graph-header" id="graphHeader">
                <div>
                    <span class="unit-info" id="currentUnit">-</span>
                    <span class="unit-info" id="currentChar">-</span>
                </div>
                <h2 id="currentTitle">å‹•ç”»ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
            </div>

            <div class="chart-container">
                <canvas id="viewChart"></canvas>
            </div>

            <div class="graph-footer">
                <div class="stat-item">
                    <span class="label">ç¾åœ¨å†ç”Ÿæ•°</span>
                    <span class="value" id="currentViews">-</span>
                </div>
                <div class="stat-item">
                    <span class="label">å‰å›æ¯”(å¢—åŠ é‡)</span>
                    <span class="value" id="currentGrowth" style="color: var(--accent-color)">-</span>
                </div>
                <div class="stat-item">
                    <span class="label">æŠ•ç¨¿æ—¥</span>
                    <span class="value" id="currentDate">-</span>
                </div>
            </div>
        </div>

        <div class="ranking-area">
            <h3>ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
            <ul class="ranking-list" id="rankingList">
                </ul>
        </div>

    </div>
</div>

<script>
    let chartInstance = null;
    let allData = {}; // JSONãƒ‡ãƒ¼ã‚¿ä¿æŒç”¨

    // JSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ï¼ˆå®Ÿéš›ã®ãƒ‘ã‚¹ã«åˆã‚ã›ã¦ãã ã•ã„ï¼‰
    fetch('stats_history.json')
        .then(response => response.json())
        .then(data => {
            allData = data;
            initApp(data);
        })
        .catch(err => console.error('Data load error:', err));

    function initApp(data) {
        // ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—åŒ–ã—ã¦æ‰±ã„ã‚„ã™ãã™ã‚‹
        const videoArray = Object.keys(data).map(key => {
            const history = data[key].history;
            const latest = history[history.length - 1];
            const prev = history.length > 1 ? history[history.length - 2] : latest;
            
            return {
                id: key,
                info: data[key].info,
                latestViews: latest.views,
                growth: latest.views - prev.views,
                history: history,
                uploadDateObj: new Date(data[key].info.uploadDate)
            };
        });

        // 1. ãƒˆãƒ¬ãƒ³ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
        renderTrends(videoArray);

        // 2. ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”Ÿæˆ (å†ç”Ÿæ•°é †)
        videoArray.sort((a, b) => b.latestViews - a.latestViews);
        renderRanking(videoArray);

        // 3. åˆæœŸé¸æŠï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°1ä½ã‚’ã‚°ãƒ©ãƒ•ã«è¡¨ç¤ºï¼‰
        if (videoArray.length > 0) {
            updateGraph(videoArray[0]);
        }
    }

    function renderTrends(videos) {
        const section = document.getElementById('trendSection');
        
        // æœ€æ–°å‹•ç”» (æŠ•ç¨¿æ—¥ãŒæ–°ã—ã„é †)
        const newest = [...videos].sort((a, b) => b.uploadDateObj - a.uploadDateObj)[0];
        // æ€¥ä¸Šæ˜‡ (å¢—åŠ é‡ãŒå¤šã„é †)
        const trending = [...videos].sort((a, b) => b.growth - a.growth)[0];
        // æœ€å¤šå†ç”Ÿ (ç´¯è¨ˆå†ç”Ÿæ•°é †)
        const mostViewed = [...videos].sort((a, b) => b.latestViews - a.latestViews)[0];

        const createCard = (title, video, icon) => `
            <div class="trend-card" onclick="selectVideo('${video.id}')" style="cursor:pointer">
                <img src="${video.info.thumbnail}" alt="thumb">
                <div class="trend-info">
                    <h3>${icon} ${title}</h3>
                    <p>${video.info.title}</p>
                </div>
            </div>
        `;

        section.innerHTML = `
            ${createCard('æœ€æ–°å‹•ç”»', newest, 'ğŸ†•')}
            ${createCard('æ€¥ä¸Šæ˜‡', trending, 'ğŸ“ˆ')}
            ${createCard('å†ç”Ÿæ•°No.1', mostViewed, 'ğŸ‘‘')}
        `;
    }

    function renderRanking(videos) {
        const list = document.getElementById('rankingList');
        list.innerHTML = '';

        videos.forEach((video, index) => {
            const li = document.createElement('li');
            li.className = 'ranking-item';
            li.id = `rank-${video.id}`;
            li.onclick = () => {
                updateGraph(video);
                // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
                document.querySelectorAll('.ranking-item').forEach(el => el.classList.remove('active'));
                li.classList.add('active');
            };

            li.innerHTML = `
                <div class="rank-badge">${index + 1}</div>
                <img class="item-thumb" src="${video.info.thumbnail}">
                <div class="item-info">
                    <p class="item-title">${video.info.title}</p>
                    <span class="item-stats">${video.latestViews.toLocaleString()} å›</span>
                </div>
            `;
            list.appendChild(li);
        });
        
        // 1ä½ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        if(videos.length > 0) {
             document.getElementById(`rank-${videos[0].id}`).classList.add('active');
        }
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å®šç¾©ï¼ˆHTMLå†…ã®onclickã‹ã‚‰å‘¼ã¶ãŸã‚ï¼‰
    window.selectVideo = function(id) {
        // IDã‹ã‚‰videoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¢ã™ç°¡æ˜“å®Ÿè£…
        // å®Ÿéš›ã¯allDataã‹ã‚‰å†æ§‹ç¯‰ã™ã‚‹ã‹ã€Mapã§ç®¡ç†ã™ã‚‹ã¨åŠ¹ç‡çš„
        const vidKey = Object.keys(allData).find(k => k === id);
        if (!vidKey) return;

        const history = allData[vidKey].history;
        const latest = history[history.length - 1];
        const prev = history.length > 1 ? history[history.length - 2] : latest;

        const videoObj = {
            id: vidKey,
            info: allData[vidKey].info,
            latestViews: latest.views,
            growth: latest.views - prev.views,
            history: history,
            uploadDateObj: new Date(allData[vidKey].info.uploadDate)
        };

        updateGraph(videoObj);
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚‚æ›´æ–°
        document.querySelectorAll('.ranking-item').forEach(el => el.classList.remove('active'));
        const rankItem = document.getElementById(`rank-${id}`);
        if(rankItem) rankItem.classList.add('active');
    }

    function updateGraph(video) {
        // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã®æ›´æ–°
        document.getElementById('currentUnit').textContent = video.info.unit || 'Unknown Unit';
        document.getElementById('currentChar').textContent = video.info.character || 'Unknown Char';
        document.getElementById('currentTitle').textContent = video.info.title;

        // ãƒ•ãƒƒã‚¿ãƒ¼æƒ…å ±ã®æ›´æ–°
        document.getElementById('currentViews').textContent = video.latestViews.toLocaleString() + ' å›';
        document.getElementById('currentGrowth').textContent = '+' + video.growth.toLocaleString();
        // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        const dateStr = video.uploadDateObj.toLocaleDateString('ja-JP');
        document.getElementById('currentDate').textContent = dateStr;

        // ã‚°ãƒ©ãƒ•æç”»
        const ctx = document.getElementById('viewChart').getContext('2d');
        
        // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆãŒã‚ã‚Œã°ç ´æ£„
        if (chartInstance) {
            chartInstance.destroy();
        }

        // ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢ (Xè»¸:æ—¥æ™‚, Yè»¸:å†ç”Ÿæ•°)
        const labels = video.history.map(h => {
            const d = new Date(h.timestamp);
            return `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:00`;
        });
        const dataPoints = video.history.map(h => h.views);

        chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'å†ç”Ÿå›æ•°',
                    data: dataPoints,
                    borderColor: '#FF0000',
                    backgroundColor: 'rgba(255, 0, 0, 0.1)',
                    borderWidth: 2,
                    pointRadius: 3,
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false } // å‡¡ä¾‹ã¯éè¡¨ç¤ºï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã¯HTMLã§è¡¨ç¤ºã™ã‚‹ãŸã‚ï¼‰
                },
                scales: {
                    y: {
                        beginAtZero: false // å¤‰åŒ–ã‚’è¦‹ã‚„ã™ãã™ã‚‹ãŸã‚0ã‹ã‚‰ã«ã—ãªã„
                    }
                }
            }
        });
    }
</script>

</body>
</html>
